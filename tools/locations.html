<!DOCTYPE html>
<html lang="en"> <!-- 将由 i18n.js 动态设置 -->
<head>
  <meta charset="utf-8" />
  <title data-i18n="tools.locations.pageTitle">Trajectory Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body, #map { width:100%; height:100%; margin:0; padding:0; background:#0f1117; color:#fff; font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif; }
    .panel { position:absolute; z-index:9999; left:12px; top:12px; background:rgba(15,15,15,0.7); border-radius:12px; padding:10px 14px; box-shadow:0 12px 32px rgba(0,0,0,0.6); font-size:13px; line-height:1.4; max-width:380px; backdrop-filter:blur(8px); color:#eee; user-select:none; transition:transform .22s ease, opacity .22s ease, max-height .22s ease, padding .22s ease; }
    .panel b { color:#fff; font-weight:600; font-size:13px; }
    .panel-header { display:flex; align-items:center; gap:8px; cursor:default; }
    .panel-title { display:flex; align-items:center; gap:8px; min-width:0; }
    .mini { font-size:11px; color:#9aa4af; padding:2px 6px; border-radius:999px; border:1px solid #2b3138; background:rgba(0,0,0,.25); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:220px; }
    .toggle { margin-left:auto; border:1px solid #30363d; background:#11141a; color:#e6edf3; border-radius:8px; padding:4px 8px; cursor:pointer; font-size:12px; }
    .toggle:hover { background:#171b22; }
    .content { margin-top:8px; }
    .row { margin-top:8px; display:grid; gap:6px; }
    .row.inline { grid-template-columns: auto 1fr; align-items:center; }
    .row input[type="datetime-local"], .row input[type="color"]{ width:100%; box-sizing:border-box; border-radius:8px; border:1px solid #30363d; background:#0b0d12; color:#e6edf3; padding:6px 8px; }
    .btns { display:flex; gap:8px; margin-top:6px; }
    .btns button, .btns label.btn { flex:1; border:1px solid #30363d; background:#11141a; color:#e6edf3; border-radius:8px; padding:6px 10px; cursor:pointer; text-align:center; }
    .btns button:hover, .btns label.btn:hover { background:#171b22; }
    .muted { color:#aaa; }
    .dropzone { margin-top:8px; border:1px dashed #3a3f44; border-radius:10px; padding:8px; text-align:center; font-size:12px; color:#c9d1d9; background:rgba(13,15,22,0.5); transition:background .2s, border-color .2s; }
    .dropzone.dragover { border-color:#58a6ff; background:rgba(13,15,22,0.8); }
    .fileok { color:#59f; font-size:12px; word-break:break-all; }
    .error { color:#ff6b6b; font-size:12px; white-space:pre-wrap; }

    .loading { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.35); z-index: 99999; backdrop-filter: blur(2px); }
    .loading.show { display: flex; }
    .spinner { width: 56px; height: 56px; border-radius: 50%; border: 6px solid rgba(255,255,255,0.2); border-top-color: #58a6ff; animation: spin 0.9s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { margin-top: 12px; color: #c9d1d9; font-size: 12px; text-align: center; }

    .panel.collapsed { padding:8px 10px; max-height:48px; overflow:hidden; }
    .panel.collapsed .content { display:none; }
    .opts { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .opts .seg { display:flex; gap:8px; align-items:center; }
    .opts label { display:flex; gap:6px; align-items:center; cursor:pointer; }
  </style>

  <!-- 百度地图 WebGL API（替换 ak 为你的） -->
  <script src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=sUryxWWxRyHZxuzB634wHfmlqy6RgMEy"></script>
  <!-- sql.js（SQLite WASM） -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.2/sql-wasm.js"></script>

  <!-- 默认内联数据（可替换为你的点） -->
  <script id="trackData" type="application/json">[]</script>
</head>
<body>
<!-- 统一 Header（可选） -->
<script src="/js/i18n.js"></script>
<script src="/js/header.js"></script>
<script>
  // 如不需要 Header，可移除本段
  TTHeader?.create({
    brandHref: "/",
    nav: [
      { href: "/", key: "tools.header.nav.home" },
      { href: "/tools/", key: "tools.header.nav.tools" },
      { href: location.pathname, key: "tools.header.nav.locations" }
    ],
    showTheme: true,
    showLang: true
  });
</script>

<div id="map"></div>

<div class="panel" id="infoPanel">
  <div class="panel-header" data-i18n-title="tools.locations.panelHeaderTooltip">
    <div class="panel-title">
      <b data-i18n="tools.locations.panelTitle">Trajectory Preview</b>
      <span id="miniStats" class="mini">—</span>
    </div>
    <button id="togglePanel" class="toggle" aria-expanded="false" data-i18n="tools.locations.fold">Collapse</button>
  </div>

  <div class="content">
    <div class="row">
      <div class="btns">
        <label class="btn" for="fileInput" data-i18n="tools.locations.chooseFile">Choose file (.json / .db / .sqlite / .csv / .gpx / .kml)</label>
      </div>
      <input id="fileInput" type="file"
             accept=".json,application/json,.db,.sqlite,application/octet-stream,.csv,text/csv,.gpx,application/gpx+xml,.kml,application/vnd.google-earth.kml+xml"
             style="display:none" />
      <div class="dropzone" id="dropzone" data-i18n="tools.locations.dropHint">Drag files here</div>
      <div class="muted" data-i18n="tools.locations.hintFormats">
        JSON/CSV needs time + lat/lng; GPX/KML auto-detect; SQLite auto detect table & columns. WGS84 by default; if fields like gcj02* or isMarsLocation exist, use GCJ-02.
      </div>
      <div id="fileStatus" class="fileok" style="display:none;"></div>
      <div id="fileError" class="error" style="display:none;"></div>
    </div>

    <div class="row">
      <label data-i18n="tools.locations.timeSegmentLabel">Time segment (local):</label>
      <input id="startInput" type="datetime-local" step="1" />
      <input id="endInput" type="datetime-local" step="1" />
      <div class="btns">
        <button id="applyBtn" data-i18n="tools.locations.apply">Apply</button>
        <button id="resetBtn" title="" data-i18n="tools.locations.reset">Reset</button>
      </div>
    </div>

    <div class="row">
      <div class="opts">
        <div class="seg">
          <label><input type="checkbox" id="optShowPoints" checked> <span data-i18n="tools.locations.showPoints">Show points</span></label>
          <label><input type="checkbox" id="optShowLine"> <span data-i18n="tools.locations.connectLine">Connect line</span></label>
        </div>
        <div class="seg">
          <span data-i18n="tools.locations.color">Color</span>
          <input type="color" id="pointColor" value="#5ab1ff" style="width:48px; height:32px; padding:0; border-radius:8px;">
        </div>
      </div>
      <div class="muted" data-i18n="tools.locations.bigDataHint">
        ≥1000 use PointCollection; fallback Canvas; polyline limited for very large datasets.
      </div>
    </div>

    <div class="row">
      <div id="statsCount" data-i18n="tools.locations.statsCount" data-count="-">Count: -</div>
      <div id="statsRange" data-i18n="tools.locations.statsRange" data-start="—" data-end="—">Range: —</div>
    </div>
  </div>
</div>

<div id="loading" class="loading" aria-live="polite" aria-busy="true">
  <div>
    <div class="spinner"></div>
    <div id="loadingText" class="loading-text" data-i18n="tools.locations.loading">Loading…</div>
  </div>
</div>

<!-- 页面主逻辑 -->
<script src="/js/locations.js"></script>
</body>
</html>
